<link rel="import" href="../g-cookies/g-cookies.html">

<polymer-element name="g-app-controller" attributes="sessionCookieName start">
	<template>
		<link rel="stylesheet" href="g-app-controller.css">
		<g-cookies id="cookies"></g-cookies>
		<div class="{{ !loggedIn ? 'show' : 'hide' }}">
			<content select="[whenNotLoggedIn]"></content>
		</div>
		<div class="{{ loggedIn ? 'show' : 'hide' }}">
			<content select="[whenLoggedIn]"></content>
		</div>
	</template>
	<script>
		Polymer('g-app-controller', {

			loggedIn: false,

			logoff: function() {
				this.loggedIn = false;
			},

			ready: function() {

				var router = this.querySelector('g-app-router');
				if(router)
				{
					var $this = this;
					var cookie = this.$.cookies.getItem(this.sessionCookieName);
					var start = this.start;

					/* Can't know for sure if the external element is ready */
					router.addEventListener('router-ready', function(){
						if(cookie)
						{
							$this.loggedIn = true;
							router.init();
							router.goTo(start);
						}
					});
				}
			},
		});


	</script>
</polymer-element>
